<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Khảo Sát Lịch Dạy Giáo Viên</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (để biên dịch JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Animation Custom */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.5s ease-out forwards;
        }
        
        @keyframes fade-in-down {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-down {
            animation: fade-in-down 0.3s ease-out forwards;
        }

        /* Ẩn nút tăng giảm mặc định của input number để giao diện đẹp hơn */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }

        .cursor-wait {
            cursor: wait;
        }
        
        /* Ngăn chặn hành vi zoom khi double tap trên iOS */
        button {
            touch-action: manipulation;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans antialiased">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // --- ĐỊNH NGHĨA ICONS ---
        const Icon = ({ size = 24, className = "", children, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {children}
            </svg>
        );

        const Plus = (props) => <Icon {...props}><path d="M5 12h14" /><path d="M12 5v14" /></Icon>;
        const Trash2 = (props) => <Icon {...props}><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></Icon>;
        const Clock = (props) => <Icon {...props}><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></Icon>;
        const Users = (props) => <Icon {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></Icon>;
        const Calendar = (props) => <Icon {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></Icon>;
        const Save = (props) => <Icon {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></Icon>;
        const User = (props) => <Icon {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></Icon>;
        const MapPin = (props) => <Icon {...props}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></Icon>;
        const GraduationCap = (props) => <Icon {...props}><path d="M22 10v6M2 10l10-5 10 5-10 5z" /><path d="M6 12v5c3 3 9 3 12 0v-5" /></Icon>;
        const Book = (props) => <Icon {...props}><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" /><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" /></Icon>;
        const Sparkles = (props) => <Icon {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /></Icon>;
        const Sun = (props) => <Icon {...props}><circle cx="12" cy="12" r="4" /><path d="M12 2v2" /><path d="M12 20v2" /><path d="m4.93 4.93 1.41 1.41" /><path d="m17.66 17.66 1.41 1.41" /><path d="M2 12h2" /><path d="M20 12h2" /><path d="m6.34 17.66-1.41 1.41" /><path d="m19.07 4.93-1.41 1.41" /></Icon>;
        const Moon = (props) => <Icon {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" /></Icon>;
        const Loader2 = (props) => <Icon {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56" /></Icon>;
        const XCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10" /><line x1="15" x2="9" y1="9" y2="15" /><line x1="9" x2="15" y1="9" y2="15" /></Icon>;

        // --- CẤU HÌNH KẾT NỐI GOOGLE SHEET ---
        // Đã cập nhật lại link gốc bạn cung cấp
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxbJrkkTJYFs0rR8WlSJN2SmXyvS1-99f3ngJ4629sXbUJa1T83piqnSgUu2vDO6jN1/exec";

        function App() {
            const [teacherInfo, setTeacherInfo] = useState({ name: '' });
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [errorMsg, setErrorMsg] = useState('');
            
            const locations = [
                "Cơ Sở Biệt Thự",
                "Cơ Sở Nguyễn Văn Siêu",
                "Cơ Sở Miễn Phí",
                "Cơ Sở Tân Đông Hiệp B",
                "Cơ Sở Bình An",
                "Cơ Sở Đông Hòa",
                "Cơ Sở Võ Trường Toản",
                "Cơ Sở Thủ Đức"
            ];

            const grades = ["6", "7", "8", "9"];
            const subjects = ["Toán", "Tiếng Anh", "KHTN", "Văn"];

            const daysOfWeek = [
                { key: 'T2', label: 'T2' },
                { key: 'T3', label: 'T3' },
                { key: 'T4', label: 'T4' },
                { key: 'T5', label: 'T5' },
                { key: 'T6', label: 'T6' },
                { key: 'T7', label: 'T7' },
                { key: 'CN', label: 'CN' },
            ];

            const [schedules, setSchedules] = useState([
                { 
                    id: Date.now(), 
                    location: locations[0], 
                    grade: '9', 
                    subject: 'Toán',
                    defaultTime: '17:30', 
                    sessions: [], 
                    studentCount: 20 
                }
            ]);
            const [submitted, setSubmitted] = useState(false);

            const generateClassName = (index, schedule) => {
                return `Ca số ${index + 1}: ${schedule.subject}; Khối ${schedule.grade}; ${schedule.location}`;
            };

            const getTimeSessionLabel = (timeStr) => {
                if (!timeStr) return "";
                const hour = parseInt(timeStr.split(':')[0], 10);
                if (hour < 12) return "Sáng";
                return "Chiều Tối";
            };

            const addSchedule = () => {
                setSchedules([
                    ...schedules,
                    { 
                        id: Date.now(), 
                        location: locations[0], 
                        grade: '9', 
                        subject: 'Toán',
                        defaultTime: '17:30', 
                        sessions: [], 
                        studentCount: 20 
                    }
                ]);
            };

            const removeSchedule = (id) => {
                if (schedules.length === 1) return;
                setSchedules(schedules.filter(s => s.id !== id));
            };

            const updateSchedule = (id, field, value) => {
                setSchedules(schedules.map(item => 
                    item.id === id ? { ...item, [field]: value } : item
                ));
            };

            const toggleDay = (scheduleId, dayKey) => {
                const schedule = schedules.find(s => s.id === scheduleId);
                const existingSessionIndex = schedule.sessions.findIndex(s => s.day === dayKey);
                
                let newSessions = [...schedule.sessions];

                if (existingSessionIndex >= 0) {
                    newSessions.splice(existingSessionIndex, 1);
                } else {
                    newSessions.push({ day: dayKey, time: schedule.defaultTime });
                }

                const order = ['T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'CN'];
                newSessions.sort((a, b) => order.indexOf(a.day) - order.indexOf(b.day));

                updateSchedule(scheduleId, 'sessions', newSessions);
            };

            const updateSessionTime = (scheduleId, dayKey, newTime) => {
                const schedule = schedules.find(s => s.id === scheduleId);
                const newSessions = schedule.sessions.map(s => 
                    s.day === dayKey ? { ...s, time: newTime } : s
                );
                updateSchedule(scheduleId, 'sessions', newSessions);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setErrorMsg('');
                
                if (!teacherInfo.name || teacherInfo.name.trim() === '') {
                    setErrorMsg("Vui lòng điền họ và tên giáo viên.");
                    return;
                }

                if (schedules.some(s => s.sessions.length === 0)) {
                    setErrorMsg("Vui lòng chọn ít nhất một buổi học cho mỗi ca dạy.");
                    return;
                }
                
                setIsSubmitting(true);

                const payload = {
                    teacherName: teacherInfo.name,
                    classes: schedules.map((s, index) => ({
                        code: generateClassName(index, s),
                        location: s.location,
                        grade: s.grade,
                        subject: s.subject,
                        count: s.studentCount,
                        sessions: s.sessions.map(sess => `${sess.day} (${sess.time})`).join(', ')
                    }))
                };

                try {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: "POST",
                        mode: "no-cors", 
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload),
                    });
                    console.log("Dữ liệu đã gửi:", payload);
                    setSubmitted(true);
                } catch (error) {
                    console.error("Lỗi khi gửi:", error);
                    setErrorMsg("Có lỗi kết nối xảy ra khi gửi dữ liệu. Vui lòng kiểm tra mạng và thử lại!");
                } finally {
                    setIsSubmitting(false);
                }
            };

            const TimeInputStandard = ({ value, onChange, compact = false }) => {
                const label = getTimeSessionLabel(value);
                const isMorning = label === 'Sáng';

                return (
                    <div className={`flex items-center gap-1.5 w-full transition-all rounded-lg ${compact ? 'p-0' : 'p-0'}`}>
                        <input 
                            type="time" 
                            value={value}
                            onChange={onChange}
                            className={`
                                font-mono font-bold text-gray-700 bg-white border-2 border-gray-200 rounded-lg outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 transition-all cursor-pointer shadow-sm
                                ${compact ? 'h-10 text-base px-2 w-full' : 'h-12 text-lg px-4 w-full'}
                                ${isMorning ? 'hover:border-yellow-300' : 'hover:border-indigo-300'}
                            `}
                        />
                        <div className={`
                            flex items-center gap-1 font-bold uppercase tracking-wider rounded-lg border shadow-sm shrink-0 select-none justify-center
                            ${compact ? 'w-10 h-10 px-0' : 'px-4 h-12 text-xs'}
                            ${isMorning 
                                ? 'bg-yellow-50 text-yellow-700 border-yellow-200' 
                                : 'bg-indigo-50 text-indigo-700 border-indigo-200'}
                        `}>
                            {isMorning ? <Sun size={compact ? 16 : 18} /> : <Moon size={compact ? 16 : 18} />}
                            <span className={`hidden sm:inline ml-1 ${compact ? 'hidden sm:hidden md:hidden lg:inline' : ''}`}>{!compact && label}</span>
                        </div>
                    </div>
                );
            };

            const ErrorModal = ({ message, onClose }) => {
                if (!message) return null;
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 animate-fade-in-up">
                        <div className="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 relative">
                            <button onClick={onClose} className="absolute top-3 right-3 text-gray-400 hover:text-red-500">
                                <XCircle size={24} />
                            </button>
                            <div className="flex flex-col items-center text-center">
                                <div className="bg-red-100 p-3 rounded-full mb-4">
                                    <XCircle size={32} className="text-red-600" />
                                </div>
                                <h3 className="text-lg font-bold text-gray-800 mb-2">Thông báo</h3>
                                <p className="text-gray-600 mb-6">{message}</p>
                                <button onClick={onClose} className="w-full py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition">Đã hiểu</button>
                            </div>
                        </div>
                    </div>
                );
            };

            if (submitted) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 flex items-center justify-center p-4">
                        <div className="bg-white p-8 rounded-2xl shadow-xl max-w-md text-center w-full animate-fade-in-up">
                            <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <CheckCircle size={40} className="text-green-600" />
                            </div>
                            <h2 className="text-2xl font-bold text-gray-800 mb-2">Đăng ký thành công!</h2>
                            <p className="text-gray-600 mb-6">Dữ liệu đã được lưu vào hệ thống.</p>
                            <button 
                                onClick={() => {
                                    setSubmitted(false);
                                    setSchedules([{ 
                                        id: Date.now(), location: locations[0], grade: '9', subject: 'Toán', defaultTime: '17:30', sessions: [], studentCount: 20 
                                    }]);
                                    setTeacherInfo({ name: '' });
                                }}
                                className="w-full py-3 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition shadow-lg shadow-indigo-200"
                            >
                                Nhập khảo sát mới
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 py-4 px-3 sm:py-8 sm:px-6 font-sans">
                    <div className="max-w-3xl mx-auto">
                        
                        <div className="text-center mb-6 sm:mb-8 bg-white p-4 sm:p-6 rounded-2xl shadow-sm border-t-4 border-indigo-500">
                            {/* CẬP NHẬT TIÊU ĐỀ và Responsive Font Size */}
                            <h1 className="text-lg sm:text-2xl md:text-3xl font-extrabold text-indigo-900 uppercase tracking-tight leading-snug">
                                THỐNG KÊ SỐ LƯỢNG HỌC SINH<br/>HỆ THỐNG GIÁO DỤC TÂM ĐỨC KHỐI CẤP 2
                            </h1>
                            <p className="text-gray-500 mt-2 font-medium text-sm sm:text-base">Điền thông tin lớp học và thời gian giảng dạy</p>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-6">
                            
                            <div className="bg-white rounded-2xl p-4 sm:p-6 shadow-sm border border-gray-100">
                                <h2 className="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                    <User size={20} className="text-indigo-600" />
                                    Thông tin Giáo viên
                                </h2>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Họ và tên</label>
                                    <input 
                                        type="text" 
                                        className="w-full px-4 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition text-base sm:text-sm"
                                        placeholder="Nhập họ tên của bạn..."
                                        value={teacherInfo.name}
                                        onChange={e => setTeacherInfo({...teacherInfo, name: e.target.value})}
                                    />
                                </div>
                            </div>

                            <div className="space-y-6">
                                <div className="flex justify-between items-end">
                                    <h2 className="text-lg font-semibold text-gray-800 flex items-center gap-2">
                                        <Calendar size={20} className="text-indigo-600" />
                                        Chi tiết Lớp học
                                    </h2>
                                </div>

                                {schedules.map((schedule, index) => {
                                    const autoClassName = generateClassName(index, schedule);
                                    
                                    return (
                                        <div key={schedule.id} className="bg-white rounded-2xl shadow-md border-l-4 border-indigo-500 relative transition-all hover:shadow-lg overflow-hidden">
                                            
                                            {schedules.length > 1 && (
                                                <button type="button" onClick={() => removeSchedule(schedule.id)} className="absolute top-2 right-2 sm:top-4 sm:right-4 z-10 text-gray-400 hover:text-red-500 transition p-2 bg-white rounded-full shadow-sm border border-gray-100">
                                                    <Trash2 size={18} />
                                                </button>
                                            )}

                                            <div className="p-4 sm:p-6 grid grid-cols-1 gap-6">
                                                {/* BƯỚC 1 */}
                                                <div>
                                                    <div className="flex items-center gap-2 mb-3">
                                                        <span className="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-1 rounded">Bước 1</span>
                                                        <span className="text-sm font-semibold text-gray-500 uppercase tracking-wide">Thiết lập thông tin lớp</span>
                                                    </div>
                                                    
                                                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                                        {/* Cơ sở */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1"><MapPin size={14} /> Cơ sở</label>
                                                            <div className="relative">
                                                                <select className="w-full px-3 py-2 bg-white rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 outline-none appearance-none cursor-pointer text-base sm:text-sm" value={schedule.location} onChange={(e) => updateSchedule(schedule.id, 'location', e.target.value)}>
                                                                    {locations.map((loc) => <option key={loc} value={loc}>{loc}</option>)}
                                                                </select>
                                                                <div className="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-500"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg></div>
                                                            </div>
                                                        </div>
                                                        {/* Khối */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1"><GraduationCap size={14} /> Khối Lớp</label>
                                                            <div className="relative">
                                                                <select className="w-full px-3 py-2 bg-white rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 outline-none appearance-none cursor-pointer text-base sm:text-sm" value={schedule.grade} onChange={(e) => updateSchedule(schedule.id, 'grade', e.target.value)}>
                                                                    {grades.map(g => <option key={g} value={g}>Khối {g}</option>)}
                                                                </select>
                                                                <div className="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-500"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg></div>
                                                            </div>
                                                        </div>
                                                        {/* Bộ môn */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1"><Book size={14} /> Bộ Môn</label>
                                                            <div className="relative">
                                                                <select className="w-full px-3 py-2 bg-white rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500 outline-none appearance-none cursor-pointer text-base sm:text-sm" value={schedule.subject} onChange={(e) => updateSchedule(schedule.id, 'subject', e.target.value)}>
                                                                    {subjects.map(s => <option key={s} value={s}>{s}</option>)}
                                                                </select>
                                                                <div className="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-500"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* MÃ LỚP TỰ ĐỘNG */}
                                                <div className="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl p-4 border border-indigo-200 flex items-center gap-4 shadow-inner">
                                                    <div className="bg-white p-3 rounded-full shadow-sm text-yellow-500 animate-pulse"><Sparkles size={24} /></div>
                                                    <div className="flex-1">
                                                        <label className="text-xs font-bold text-indigo-500 uppercase tracking-wider block mb-1">Mã Lớp (Tự động)</label>
                                                        <div className="font-extrabold text-red-600 text-lg sm:text-2xl break-words tracking-tight drop-shadow-sm">
                                                            {autoClassName} <span className="ml-1 text-yellow-500"></span>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* BƯỚC 2 */}
                                                <div className="bg-indigo-50/50 rounded-xl p-4 border border-indigo-100">
                                                    <div className="flex items-center gap-2 mb-3">
                                                        <span className="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-1 rounded">Bước 2</span>
                                                        <span className="text-sm font-semibold text-gray-500 uppercase tracking-wide">Chọn khung giờ dạy</span>
                                                    </div>

                                                    <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4">
                                                        <div className="sm:w-1/2">
                                                            <label className="block text-sm font-bold text-gray-700 mb-1">Giờ học chung</label>
                                                            <p className="text-xs text-gray-500">Giờ này sẽ áp dụng tự động khi bạn chọn các ngày bên dưới</p>
                                                        </div>
                                                        <div className="sm:w-1/2">
                                                            <TimeInputStandard value={schedule.defaultTime} onChange={(e) => updateSchedule(schedule.id, 'defaultTime', e.target.value)} />
                                                        </div>
                                                    </div>

                                                    <div className="mb-4">
                                                        <label className="block text-xs font-bold text-gray-500 mb-2 uppercase">Chọn ngày trong tuần:</label>
                                                        <div className="flex flex-wrap gap-2 justify-center sm:justify-start">
                                                            {daysOfWeek.map((day) => {
                                                                const isSelected = schedule.sessions.some(s => s.day === day.key);
                                                                return (
                                                                    <button key={day.key} type="button" onClick={() => toggleDay(schedule.id, day.key)} className={`w-11 h-11 sm:w-10 sm:h-10 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-200 shadow-sm ${isSelected ? 'bg-indigo-600 text-white shadow-indigo-300 transform scale-110' : 'bg-white text-gray-500 border border-gray-200 hover:bg-gray-100 hover:border-indigo-300'}`}>
                                                                        {day.label}
                                                                    </button>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>

                                                    {/* Danh sách chi tiết */}
                                                    {schedule.sessions.length > 0 && (
                                                        <div className="animate-fade-in-down">
                                                            <div className="space-y-2 border-t border-indigo-100 pt-3 mt-3">
                                                                {schedule.sessions.map((session) => (
                                                                    <div key={session.day} className="flex flex-row items-center justify-between bg-white p-2 rounded-xl border border-gray-200 gap-2">
                                                                        <div className="flex items-center gap-2 shrink-0">
                                                                            <div className="w-10 h-10 sm:w-10 sm:h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold shadow-sm text-sm sm:text-base">{session.day}</div>
                                                                            <span className="text-sm text-gray-500 hidden sm:inline">Thời gian:</span>
                                                                        </div>
                                                                        <div className="flex-1 max-w-[200px] sm:max-w-xs">
                                                                            <TimeInputStandard value={session.time} compact={true} onChange={(e) => updateSessionTime(schedule.id, session.day, e.target.value)} />
                                                                        </div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    )}
                                                    {schedule.sessions.length === 0 && (
                                                        <p className="text-xs text-red-400 mt-2 italic flex items-center gap-1"><Clock size={12}/> Vui lòng chọn ít nhất 1 ngày học ở trên</p>
                                                    )}
                                                </div>

                                                {/* BƯỚC 3 */}
                                                <div>
                                                    <div className="flex justify-between mb-2 items-center">
                                                        <div className="flex items-center gap-2">
                                                            <span className="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-1 rounded">Bước 3</span>
                                                            <label className="text-sm font-semibold text-gray-700 flex items-center gap-1">
                                                                <Users size={16} /> Sĩ số lớp
                                                            </label>
                                                        </div>
                                                        
                                                        {/* Ô NHẬP SỐ */}
                                                        <div className="flex items-center gap-1 bg-indigo-50 border border-indigo-200 rounded-lg px-2 py-1">
                                                            <input 
                                                                type="number" 
                                                                min="1" max="100"
                                                                className="w-12 bg-transparent font-bold text-indigo-700 text-right outline-none text-base sm:text-sm"
                                                                value={schedule.studentCount}
                                                                onChange={(e) => updateSchedule(schedule.id, 'studentCount', e.target.value === '' ? '' : parseInt(e.target.value))}
                                                                onBlur={(e) => {
                                                                    let val = parseInt(e.target.value);
                                                                    if(!val || val < 1) val = 1;
                                                                    if(val > 100) val = 100;
                                                                    updateSchedule(schedule.id, 'studentCount', val);
                                                                }}
                                                            />
                                                            <span className="text-xs font-bold text-indigo-500">HS</span>
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Chú thích hướng dẫn */}
                                                    <p className="text-xs text-gray-500 mb-2 italic">Kéo thanh trượt hoặc nhập số trực tiếp vào ô HS bên phải.</p>

                                                    {/* THANH TRƯỢT */}
                                                    <input 
                                                        type="range" 
                                                        min="1" 
                                                        max="50" 
                                                        className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                                                        value={schedule.studentCount || 1}
                                                        onChange={(e) => updateSchedule(schedule.id, 'studentCount', parseInt(e.target.value))}
                                                    />
                                                    <div className="flex justify-between text-xs text-gray-400 mt-1 px-1">
                                                        <span>1</span>
                                                        <span>50+</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}

                                <button type="button" onClick={addSchedule} className="w-full py-4 border-2 border-dashed border-indigo-300 text-indigo-600 rounded-xl font-medium hover:bg-indigo-50 transition flex items-center justify-center gap-2">
                                    <Plus size={20} />
                                    Thêm Lớp / Ca dạy khác
                                </button>
                            </div>

                            <div className="pt-4 pb-10">
                                <button type="submit" disabled={isSubmitting} className={`w-full py-4 bg-gradient-to-r from-indigo-600 to-blue-600 text-white rounded-xl font-bold text-lg shadow-lg shadow-indigo-200 hover:shadow-xl hover:scale-[1.01] transition-all flex items-center justify-center gap-2 ${isSubmitting ? 'opacity-75 cursor-wait' : ''}`}>
                                    {isSubmitting ? <><Loader2 className="animate-spin" size={24} /> Đang gửi dữ liệu...</> : <><Save size={24} /> Hoàn tất & Gửi</>}
                                </button>
                            </div>

                        </form>
                        <ErrorModal message={errorMsg} onClose={() => setErrorMsg('')} />
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>